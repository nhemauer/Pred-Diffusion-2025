---
title: "Main"
output:
  html_document:
    df_print: paged
---

Data aggregation script for Hemauer, Saunders, and Desmarais.

Last updated: 5/24/25

TODO: Run the original models from the original papers--don't use network models for now.
  -Use PR Curve (for imbalanced data)

```{r}

### Preprocessing

library(tidyverse)
library(haven)
library(car)
library(eha)
library(sandwich)
library(lmtest)
library(rsample)
library(caret)

set.seed(1337)

boehmke_2017_full <- read_dta("boehmke_analysis/replication_data/boehmke2017.dta")
boushey_2016_full <- read_dta("boushey_analysis/replication_data/boushey2016.dta")
bricker_lacombe_2021_full <- read_dta("bricker_lacombe_analysis/replication_data/monadic_analysis_largen.dta")
karch_2016_full <- read_dta("karch_analysis/replication_data/karch2016.dta")

```

ORIGINAL REPLICATIONS


Boehmke replication estimates are exact.

```{r}

### Boehmke et al. 2017 
## PEHA

# Covariates
covariates <- c("srcs_decay","nbrs_lag","rpcpinc","totpop","legp_squire",
                "citi6010","unif_rep","unif_dem","time","time_sq","time_cube")

# Remove Data After Adoption and Omit Missing
boehmke_2017 <- na.omit(boehmke_2017_full[, c("state", "year", "statepol", "adopt", covariates)])

# Character to Factor
boehmke_2017$state <- as.factor(boehmke_2017$state)

# Fit
boehmke_formula <- as.formula(paste("adopt ~ state +", paste(c(covariates), collapse = "+")))

peha_boehmke <- glm(boehmke_formula, data = boehmke_2017, family = binomial)

coeftest(peha_boehmke, vcov = vcovHC, cluster = ~ statepol)

```


Boushey replication estimates are close, but not identical to the original estimates. 

```{r}

### Boushey 2016 
## PEHA

# Covariates
covariates <- c("policycongruent","gub_election","elect2", "hvd_4yr", "fedcrime",
                "leg_dem_per_2pty","dem_governor","insession","propneighpol",
                "citidist","squire_prof86","citi6008","crimespendpc","crimespendpcsq",
                "violentthousand","pctwhite","stateincpercap","logpop","counter","counter2","counter3")

# Remove data after adoption and omit missing
boushey_2016 <- na.omit(boushey_2016_full)

# Fit
boushey_formula <- as.formula(paste("dvadopt ~", paste(c(covariates), collapse = "+")))

peha_boushey <- glm(boushey_formula, data = boushey_2016, family = binomial)

coeftest(peha_boushey, vcov = vcovHC, cluster = ~ styear)

```


Bricker and Lacombe replication estimates are close, but not identical to the original estimates. 

# Maybe missing robust std. errors?
# My data has more obs. then reported in the article model

```{r}

### Bricker & Lacombe 2021
## PEHA

# Covariates
covariates <- c("std_score","initiative","init_sigs","std_population",
                "std_citideology","unified","std_income","std_legp_squire",
                "duration","durationsq","durationcb", "year")

# Character to Factor
bricker_lacombe_2021_full$year <- as.factor(bricker_lacombe_2021_full$year)

# Remove data after adoption and omit missing
bricker_2021 <- na.omit(bricker_lacombe_2021_full)

# Fit
bricker_formula <- as.formula(paste("adoption ~", paste(c(covariates), collapse = "+")))

peha_bricker <- glm(bricker_formula, data = bricker_2021, family = binomial)

coeftest(peha_bricker, vcov = vcovHC, cluster = ~ stateyear)

```


Karch replicaton estimates are nowhere close to the original estimates.

```{r}

### Karch 2016
## PEHA

# Remove data after adoption and omit missing
karch_2016 <- na.omit(karch_2016_full)

# Fit
peha_karch <- glm(adopt ~ traditional + nborsstd + traditional*nborsstd+prevadoptstd + traditional*prevadoptstd + 
                  complexity + traditional*complexity + igrole + traditional*igrole + regov + traditional*regov + 
                  unified + traditional*unified + perdemstd + traditional*perdemstd + incpcadjstd + traditional*incpcadjstd + 
                  exppcadjstd + traditional*exppcadjstd + logpopstd + traditional*logpopstd + collegstd + traditional*collegstd + 
                  perurbanstd + traditional*perurbanstd + profstd + traditional*profstd,  
                  data = karch_2016) 

coeftest(peha_karch, vcov = vcovHC, cluster = ~ stateyear)

```
